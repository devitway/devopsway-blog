{{/* layouts/shortcodes/diagram.html */}}

{{/* 
–®–æ—Ä—Ç–∫–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
{{< diagram type="microservices" id="my-diagram" title="–ú–æ—è –¥–∏–∞–≥—Ä–∞–º–º–∞" >}}
{{< diagram type="architecture" id="arch-diagram" >}}
{{< diagram type="network" id="net-diagram" height="400" >}}
*/}}

{{/* –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}}
{{ $type := .Get "type" | default "microservices" }}
{{ $id := .Get "id" | default (printf "diagram-%d" now.Unix) }}
{{ $title := .Get "title" | default "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞" }}
{{ $description := .Get "description" | default "" }}
{{ $height := .Get "height" | default "500" }}
{{ $width := .Get "width" | default "100%" }}

{{/* –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã */}}
{{ $validTypes := slice "microservices" "architecture" "network" "custom" }}
{{ if not (in $validTypes $type) }}
  {{ $type = "microservices" }}
{{ end }}

{{/* –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ */}}
{{ $uniqueId := printf "%s-%s" $id (substr (md5 $id) 0 8) }}

{{/* –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã */}}
<div class="diagram-shortcode-wrapper" data-diagram-id="{{ $uniqueId }}">
  {{/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–∏–∞–≥—Ä–∞–º–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) */}}
  {{ if $title }}
  <div class="diagram-header">
    <h3 class="diagram-title">{{ $title }}</h3>
    {{ if $description }}
    <p class="diagram-description">{{ $description }}</p>
    {{ end }}
  </div>
  {{ end }}

  {{/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–∏–∞–≥—Ä–∞–º–º—ã —Å data-–∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ –¥–ª—è JavaScript */}}
  <div 
    id="{{ $uniqueId }}" 
    class="diagram-container" 
    data-diagram-type="{{ $type }}"
    data-diagram-height="{{ $height }}"
    data-diagram-width="{{ $width }}"
    role="img"
    aria-label="{{ $title | default "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞" }}"
  >
    {{/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */}}
    <div class="diagram-loading" id="loading-{{ $uniqueId }}">
      <span>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã...</span>
    </div>
    
    {{/* Fallback –¥–ª—è —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ JavaScript –æ—Ç–∫–ª—é—á–µ–Ω */}}
    <noscript>
      <div class="diagram-noscript">
        <p>‚ö†Ô∏è –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–∫–ª—é—á–∏—Ç—å JavaScript.</p>
        <p>–¢–∏–ø –¥–∏–∞–≥—Ä–∞–º–º—ã: <strong>{{ $type }}</strong></p>
        {{ if $description }}
        <p>{{ $description }}</p>
        {{ end }}
      </div>
    </noscript>
  </div>

  {{/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */}}
  {{ if eq $type "microservices" }}
  <div class="diagram-legend">
    <h4>–õ–µ–≥–µ–Ω–¥–∞:</h4>
    <div class="legend-items">
      <div class="legend-item">
        <span class="legend-color" style="background: #667eea;"></span>
        <span>API Gateway</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background: #48bb78;"></span>
        <span>–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background: #ed8936;"></span>
        <span>–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background: #38b2ac;"></span>
        <span>–ö—ç—à</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background: #9f7aea;"></span>
        <span>–û—á–µ—Ä–µ–¥–∏</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background: #e53e3e;"></span>
        <span>–í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã</span>
      </div>
    </div>
  </div>
  {{ end }}

  {{/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é */}}
  <details class="diagram-help">
    <summary>üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É</summary>
    <div class="diagram-help-content">
      <ul>
        <li><strong>–ó—É–º:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–ª–µ—Å–æ –º—ã—à–∏ –∏–ª–∏ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</li>
        <li><strong>–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ:</strong> –ó–∞–∂–º–∏—Ç–µ –∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –¥–∏–∞–≥—Ä–∞–º–º—É</li>
        <li><strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π</li>
        <li><strong>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å:</strong> –ù–∞–∂–º–∏—Ç–µ "‚ö° –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å" –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏</li>
      </ul>
    </div>
  </details>
</div>

{{/* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ */}}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –¥–∏–∞–≥—Ä–∞–º–º –∑–∞–≥—Ä—É–∂–µ–Ω–∞
  if (typeof window.DiagramSystem !== 'undefined') {
    // –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    setTimeout(function() {
      const diagramElement = document.getElementById('{{ $uniqueId }}');
      if (diagramElement && window.DiagramSystem.initialized) {
        // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        const loadingElement = document.getElementById('loading-{{ $uniqueId }}');
        if (loadingElement) {
          loadingElement.style.display = 'none';
        }
      }
    }, 500);
  } else {
    console.warn('–°–∏—Å—Ç–µ–º–∞ –¥–∏–∞–≥—Ä–∞–º–º –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω diagram-system.js');
  }
});
</script>